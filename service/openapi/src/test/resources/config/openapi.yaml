openapi: 3.0.2

info:
  title: DBeerpedia
  version: 3.0.0

paths:
  /breweries:
    get:
      x-dws-query: breweryCollection
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Brewery'
            application/hal+json:
              schema:
                type: object
                x-dws-envelope: true
                required:
                  - _embedded
                properties:
                  _embedded:
                    type: object
                    x-dws-envelope: true
                    required:
                      - breweries
                    properties:
                      breweries:
                        type: array
                        items:
                          $ref: '#/components/schemas/Brewery'

  /brewery/{identifier}:
    get:
      x-dws-query: brewery
      parameters:
        - name: identifier
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Brewery'
            application/hal+json:
              schema:
                $ref: '#/components/schemas/BreweryHAL'

  /breweries-pageable:
    get:
      x-dws-query: breweryPageableCollection
      parameters:
        - name: page
          in: query
          schema:
            type: integer
        - name: pageSize
          in: query
          schema:
            type: integer
            enum: [10, 20, 50]
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Brewery'
            application/hal+json:
              schema:
                type: object
                x-dws-envelope: true
                required:
                  - _embedded
                properties:
                  _embedded:
                    type: object
                    x-dws-envelope: true
                    required:
                      - breweries
                    properties:
                      breweries:
                        type: array
                        items:
                          $ref: '#/components/schemas/Brewery'

  /breweries-pageable-with-params:
    get:
      x-dws-query:
        field: breweryPageableCollection
        paging:
          pageSize: $query.pageSize
          page: $query.page
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            enum: [ 10, 20, 50 ]
            default: 10
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Brewery'
            application/hal+json:
              schema:
                type: object
                x-dws-envelope: true
                required:
                  - _embedded
                properties:
                  _embedded:
                    type: object
                    x-dws-envelope: true
                    required:
                      - breweries
                    properties:
                      breweries:
                        type: array
                        items:
                          $ref: '#/components/schemas/Brewery'

  /breweries-all-of:
    get:
      x-dws-query:
        field: breweryCollection
      parameters:
        - name: expand
          in: query
          x-dws-type: expand
          schema:
            type: array
            items:
              type: string
              enum:
                - postalAddress
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BreweryAllOf'
            application/hal+json:
              schema:
                type: object
                x-dws-envelope: true
                required:
                  - _embedded
                properties:
                  _embedded:
                    type: object
                    x-dws-envelope: true
                    required:
                      - breweries
                    properties:
                      breweries:
                        type: array
                        items:
                          $ref: '#/components/schemas/BreweryAllOf'

  /breweries-one-of:
    get:
      x-dws-query: breweryCollection
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BreweryOneOf'

  /breweries-any-of:
    get:
      x-dws-query: breweryCollection
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BreweryAnyOf'

  /breweries-object-mismatch:
    get:
      x-dws-query: breweryCollection
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  required:
                    - identifier
                    - name
                  properties:
                    identifier:
                      type: string
                    name:
                      type: object

components:
  schemas:
    Brewery:
      type: object
      required:
        - identifier
        - name
      properties:
        identifier:
          type: string
        name:
          type: string
        postalAddress:
          $ref: '#/components/schemas/Address'

    BreweryHAL:
      allOf:
        - $ref: '#/components/schemas/Brewery'
#        - type: object
#          required:
#            - _links
#          properties:
#            _links:
#              type: object
#              x-dws-envelope: true
#              required:
#                - self
#              properties:
#                self:
#                  type: object
#                  required:
#                    - href
#                  properties:
#                    href:
#                      type: string
#                      format: uri

    Address:
      type: object
      required:
        - street
      properties:
        street:
          type: string
        postalCode:
          type: string

    BreweryAllOf:
      type: object
      allOf:
        - type: object
          required:
            - identifier
            - name
          properties:
            identifier:
              type: string
        - $ref: '#/components/schemas/Nameable'
        - $ref: '#/components/schemas/Addressable'
    Nameable:
      type: object
      required:
        - name
      properties:
        name:
          type: string
    Addressable:
      type: object
      properties:
        postalAddress:
          $ref: '#/components/schemas/Address'
    AddressAllOf:
      type: object
      required:
        - street
      allOf:
        - $ref: '#/components/schemas/HasStreet'
        - type: object
          properties:
            postalCode:
              type: string
    HasStreet:
      type: object
      properties:
        street:
          type: string

    BreweryOneOf:
      type: object
      oneOf:
        - type: object
          required:
            - identifier
            - name
          properties:
            identifier:
              type: string
        - $ref: '#/components/schemas/Nameable'
        - $ref: '#/components/schemas/Addressable'

    BreweryAnyOf:
      type: object
      anyOf:
        - type: object
          required:
            - identifier
            - name
          properties:
            identifier:
              type: string
        - $ref: '#/components/schemas/Nameable'
        - $ref: '#/components/schemas/Addressable'
